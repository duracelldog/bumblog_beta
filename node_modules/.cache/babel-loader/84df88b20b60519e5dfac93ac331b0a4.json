{"ast":null,"code":"import _defineProperty from\"/Users/beomgeunshin/Desktop/bumblog/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"/Users/beomgeunshin/Desktop/bumblog/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/beomgeunshin/Desktop/bumblog/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState,useEffect}from'react';import axios from'axios';import'./BoardWrite.scss';import{useHistory}from'react-router-dom';import{searchToJson}from'../../utils';import{BsTypeBold,BsTypeItalic,BsTypeUnderline,BsTypeStrikethrough,BsListUl,BsListOl,BsTextIndentLeft,BsTextIndentRight,BsTextCenter}from'react-icons/bs';import{VscTextSize}from'react-icons/vsc';function BoardWrite(urlParams){var _useState=useState({title:'',subTitle:''}),_useState2=_slicedToArray(_useState,2),boardTitle=_useState2[0],setBoardTitle=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isUpdate=_useState4[0],setIsUpdate=_useState4[1];var _useState5=useState({_id:null}),_useState6=_slicedToArray(_useState5,2),searchVal=_useState6[0],setSearchVal=_useState6[1];var history=useHistory();var iframeRef=useRef(null);var optionsRef=useRef(null);// 텍스트 에디터 (옵션) 로직\nvar execCmd=function execCmd(exec,value,event){if(iframeRef.current&&iframeRef.current.contentDocument){iframeRef.current.contentDocument.addEventListener('keyup',checkCmdState);iframeRef.current.contentDocument.addEventListener('click',checkCmdState);}//현재 상태를 확인해야 하는 부분\nif(event){event.currentTarget.classList.toggle('on');}// insertHTML, insertImage, styleWithCss\nif(iframeRef.current&&iframeRef.current.contentDocument){if(value===''){iframeRef.current.contentDocument.execCommand(exec);}else{iframeRef.current.contentDocument.execCommand(exec,true,value);}}// 로직이 끝난 후 Textarea로 포커스 하기\nif(iframeRef.current&&iframeRef.current.contentDocument){iframeRef.current.contentDocument.body.focus();}};// 텍스트 에디터 (옵션 실시간 체크) 로직\nvar checkCmdState=function checkCmdState(){if(iframeRef.current&&iframeRef.current.contentDocument){var document=iframeRef.current.contentDocument;if(optionsRef.current){optionsRef.current.childNodes.forEach(function(list){if(list.dataset.cmd){if(document.queryCommandState(list.dataset.cmd)){list.classList.add('on');}else{list.classList.remove('on');}// console.log('list', list);\n}});}}};var fontSizeRef=useRef(null);// 텍스트 에디터 폰트사이즈 윈도우 토글\nvar fontSizeToggle=function fontSizeToggle(){if(fontSizeRef.current){fontSizeRef.current.classList.toggle('on');}};useEffect(function(){if(iframeRef.current&&iframeRef.current.contentDocument){iframeRef.current.contentDocument.designMode=\"on\";iframeRef.current.contentDocument.body.style.fontFamily='NotoSansKR-Regular';}var searchVal=urlParams.location.search;var searchData=searchToJson(searchVal);setSearchVal(searchData);console.log('searchData',searchData);// 수정요청으로 들어올 경우\nif(searchData._id){setIsUpdate(true);axios({method:'get',url:'/api/board/list',params:searchData}).then(function(res){console.log('res',res.data[0]);setBoardTitle({title:res.data[0].title,subTitle:res.data[0].subTitle});if(iframeRef.current&&iframeRef.current.contentDocument){iframeRef.current.contentDocument.body.innerHTML=res.data[0].description;}});}else{setIsUpdate(false);}return function(){if(iframeRef.current&&iframeRef.current.contentDocument){iframeRef.current.contentDocument.removeEventListener('keyup',checkCmdState);iframeRef.current.contentDocument.removeEventListener('click',checkCmdState);}};},[]);var onSubmit=function onSubmit(e){var _iframeRef$current,_iframeRef$current$co,_iframeRef$current2,_iframeRef$current2$c;e.preventDefault();// 데이터 전송\nvar boardData={_id:searchVal._id,title:boardTitle.title,subTitle:boardTitle.subTitle,description:(_iframeRef$current=iframeRef.current)===null||_iframeRef$current===void 0?void 0:(_iframeRef$current$co=_iframeRef$current.contentDocument)===null||_iframeRef$current$co===void 0?void 0:_iframeRef$current$co.body.innerHTML,writer:'bkshin2'};// 데이터 전송 확인\nconsole.log('boardTitle',boardTitle);console.log('boardArticle',(_iframeRef$current2=iframeRef.current)===null||_iframeRef$current2===void 0?void 0:(_iframeRef$current2$c=_iframeRef$current2.contentDocument)===null||_iframeRef$current2$c===void 0?void 0:_iframeRef$current2$c.body.innerHTML);// 데이터 비우기\nsetBoardTitle({title:'',subTitle:''});if(iframeRef.current&&iframeRef.current.contentDocument){iframeRef.current.contentDocument.body.innerHTML=\"\";}if(isUpdate){// 수정일 경우\naxios({method:'put',url:'/api/board/list',data:boardData}).then(function(res){console.log('put_res',res.data[0]);history.push('/board/view?_id='+searchVal._id);});}else{// 신규일 경우\naxios({method:'post',url:'/api/board/list',data:boardData}).then(function(res){console.log('post_res',res.data[0]);history.push('/board');});}};var onChangeTitle=function onChangeTitle(e){var _e$target=e.target,name=_e$target.name,value=_e$target.value;setBoardTitle(_objectSpread(_objectSpread({},boardTitle),{},_defineProperty({},name,value)));};// 텍스트 에디터 만들기 시작\n// 기능 : 볼드, 폰트사이즈 10~30, 이탤릭, 삭선, 밑줄, 번호, 점, 들여쓰기(2개), 링크, 이미지 삽입, 파일 첨부\nreturn/*#__PURE__*/React.createElement(\"main\",{className:\"bb-board-write__main\"},/*#__PURE__*/React.createElement(\"form\",{className:\"bb-board-write__form\",onSubmit:onSubmit},/*#__PURE__*/React.createElement(\"input\",{className:\"bb-board-write__title\",placeholder:\"\\uC81C\\uBAA9\\uC744 \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694.\",type:\"text\",name:\"title\",value:boardTitle===null||boardTitle===void 0?void 0:boardTitle.title,onChange:onChangeTitle}),/*#__PURE__*/React.createElement(\"input\",{className:\"bb-board-write__title--sub\",placeholder:\"\\uC18C\\uC81C\\uBAA9\\uC744 \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694.\",type:\"text\",name:\"subTitle\",value:boardTitle===null||boardTitle===void 0?void 0:boardTitle.subTitle,onChange:onChangeTitle}),/*#__PURE__*/React.createElement(\"div\",{className:\"bb-board-write__editor-wrapper\"},/*#__PURE__*/React.createElement(\"ul\",{className:\"bb-board-write__editor-options\",ref:optionsRef},/*#__PURE__*/React.createElement(\"li\",{\"data-cmd\":\"bold\",onClick:function onClick(e){return execCmd('bold','',e);}},/*#__PURE__*/React.createElement(BsTypeBold,null)),/*#__PURE__*/React.createElement(\"li\",{\"data-cmd\":\"italic\",onClick:function onClick(e){return execCmd('italic','',e);}},/*#__PURE__*/React.createElement(BsTypeItalic,null)),/*#__PURE__*/React.createElement(\"li\",{\"data-cmd\":\"underline\",onClick:function onClick(e){return execCmd('underline','',e);}},/*#__PURE__*/React.createElement(BsTypeUnderline,null)),/*#__PURE__*/React.createElement(\"li\",{\"data-cmd\":\"strikethrough\",onClick:function onClick(e){return execCmd('strikethrough','',e);}},/*#__PURE__*/React.createElement(BsTypeStrikethrough,null)),/*#__PURE__*/React.createElement(\"li\",{\"data-cmd\":\"justifycenter\",onClick:function onClick(e){return execCmd('justifycenter','',e);}},/*#__PURE__*/React.createElement(BsTextCenter,null)),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('insertunorderedlist','');}},/*#__PURE__*/React.createElement(BsListUl,null)),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('insertorderedlist','');}},/*#__PURE__*/React.createElement(BsListOl,null)),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('indent','');}},/*#__PURE__*/React.createElement(BsTextIndentLeft,null)),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('outdent','');}},/*#__PURE__*/React.createElement(BsTextIndentRight,null)),/*#__PURE__*/React.createElement(\"li\",{onClick:fontSizeToggle},/*#__PURE__*/React.createElement(VscTextSize,null),/*#__PURE__*/React.createElement(\"ul\",{className:\"bb-board-write__editor-font-box\",ref:fontSizeRef},/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','1');}},\"10px\"),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','2');}},\"13px\"),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','3');}},\"16px\"),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','4');}},\"18px\"),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','5');}},\"24px\"),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','6');}},\"32px\"),/*#__PURE__*/React.createElement(\"li\",{onClick:function onClick(e){return execCmd('fontSize','7');}},\"48px\")))),/*#__PURE__*/React.createElement(\"iframe\",{className:\"bb-board-wrtie__editor\",name:\"boadeditrot\",ref:iframeRef})),/*#__PURE__*/React.createElement(\"div\",{className:\"bb-board-write__buttons\"},/*#__PURE__*/React.createElement(\"button\",null,\"\\uCDE8\\uC18C\"),/*#__PURE__*/React.createElement(\"button\",null,\"\\uC644\\uB8CC\"))));}export default BoardWrite;","map":{"version":3,"sources":["/Users/beomgeunshin/Desktop/bumblog/src/components/board/BoardWrite.tsx"],"names":["React","useRef","useState","useEffect","axios","useHistory","searchToJson","BsTypeBold","BsTypeItalic","BsTypeUnderline","BsTypeStrikethrough","BsListUl","BsListOl","BsTextIndentLeft","BsTextIndentRight","BsTextCenter","VscTextSize","BoardWrite","urlParams","title","subTitle","boardTitle","setBoardTitle","isUpdate","setIsUpdate","_id","searchVal","setSearchVal","history","iframeRef","optionsRef","execCmd","exec","value","event","current","contentDocument","addEventListener","checkCmdState","currentTarget","classList","toggle","execCommand","body","focus","document","childNodes","forEach","list","dataset","cmd","queryCommandState","add","remove","fontSizeRef","fontSizeToggle","designMode","style","fontFamily","location","search","searchData","console","log","method","url","params","then","res","data","innerHTML","description","removeEventListener","onSubmit","e","preventDefault","boardData","writer","push","onChangeTitle","target","name"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from 'react';\nimport axios from 'axios';\n\nimport './BoardWrite.scss';\nimport {useHistory} from 'react-router-dom';\nimport {searchToJson} from '../../utils';\n\nimport {\n    BsTypeBold, \n    BsTypeItalic,\n    BsTypeUnderline,\n    BsTypeStrikethrough,\n    BsListUl,\n    BsListOl,\n    BsTextIndentLeft,\n    BsTextIndentRight,\n    BsTextCenter\n\n} from 'react-icons/bs';\nimport {VscTextSize} from 'react-icons/vsc';\n\nfunction BoardWrite(urlParams: any){\n\n    type titleType = {\n        title: string;\n        subTitle: string\n    }\n\n    const [boardTitle, setBoardTitle] = useState<titleType>({\n        title: '',\n        subTitle: ''\n    });\n    const [isUpdate, setIsUpdate] = useState(false);\n    const [searchVal, setSearchVal] = useState({_id: null});\n    let history = useHistory();\n\n    const iframeRef = useRef<HTMLIFrameElement>(null);\n    const optionsRef = useRef<HTMLUListElement>(null);\n\n\n    // 텍스트 에디터 (옵션) 로직\n    const execCmd = (exec: string, value: string, event?:React.MouseEvent<HTMLLIElement, MouseEvent>) =>{\n\n        if(iframeRef.current && iframeRef.current.contentDocument){\n            iframeRef.current.contentDocument.addEventListener('keyup', checkCmdState);\n            iframeRef.current.contentDocument.addEventListener('click', checkCmdState);\n        }\n\n        //현재 상태를 확인해야 하는 부분\n        if(event){\n            event.currentTarget.classList.toggle('on');\n        }\n        \n        \n        // insertHTML, insertImage, styleWithCss\n        if(iframeRef.current && iframeRef.current.contentDocument){\n            if(value === ''){\n                iframeRef.current.contentDocument.execCommand(exec);\n            }else{\n                iframeRef.current.contentDocument.execCommand(exec, true, value);\n            }\n        }\n\n        // 로직이 끝난 후 Textarea로 포커스 하기\n        if(iframeRef.current && iframeRef.current.contentDocument){\n            iframeRef.current.contentDocument.body.focus();\n        }\n    }\n\n\n    // 텍스트 에디터 (옵션 실시간 체크) 로직\n    const checkCmdState = () =>{\n        if(iframeRef.current && iframeRef.current.contentDocument){\n\n            const document = iframeRef.current.contentDocument;\n\n            if(optionsRef.current){\n                optionsRef.current.childNodes.forEach((list: any) => {\n                    if(list.dataset.cmd){\n                        if(document.queryCommandState(list.dataset.cmd)){\n                            list.classList.add('on');\n                        }else{\n                            list.classList.remove('on');\n                        }\n                        // console.log('list', list);\n                    } \n                });\n            }\n        }\n    }\n\n    const fontSizeRef = useRef<HTMLUListElement>(null);\n\n    // 텍스트 에디터 폰트사이즈 윈도우 토글\n    const fontSizeToggle = () =>{\n        if(fontSizeRef.current){\n            fontSizeRef.current.classList.toggle('on');\n        }\n    }\n\n    useEffect(()=>{\n        if(iframeRef.current && iframeRef.current.contentDocument){\n            iframeRef.current.contentDocument.designMode = \"on\"\n            iframeRef.current.contentDocument.body.style.fontFamily = 'NotoSansKR-Regular';\n        }\n\n        const searchVal = urlParams.location.search;\n        const searchData = searchToJson(searchVal);\n        setSearchVal(searchData);\n\n        console.log('searchData', searchData);\n\n        // 수정요청으로 들어올 경우\n        if(searchData._id){\n            setIsUpdate(true);\n            axios({\n                method: 'get',\n                url: '/api/board/list',\n                params: searchData\n            }).then((res) =>{\n                console.log('res', res.data[0]);\n\n                setBoardTitle({\n                    title: res.data[0].title,\n                    subTitle: res.data[0].subTitle\n                });\n                if(iframeRef.current && iframeRef.current.contentDocument){\n                    iframeRef.current.contentDocument.body.innerHTML = res.data[0].description;\n                }\n            });\n        }else{\n            setIsUpdate(false);\n        }\n\n\n        return ()=>{\n            if(iframeRef.current && iframeRef.current.contentDocument){\n                iframeRef.current.contentDocument.removeEventListener('keyup', checkCmdState);\n                iframeRef.current.contentDocument.removeEventListener('click', checkCmdState);\n            }\n        }\n    }, []);\n\n\n\n    const onSubmit = (e: React.FormEvent<HTMLFormElement>) =>{\n        e.preventDefault();\n\n        // 데이터 전송\n        const boardData = {\n            _id: searchVal._id,\n            title: boardTitle.title,\n            subTitle: boardTitle.subTitle,\n            description: iframeRef.current?.contentDocument?.body.innerHTML,\n            writer: 'bkshin2'\n        };\n\n        // 데이터 전송 확인\n        console.log('boardTitle', boardTitle);\n        console.log('boardArticle', iframeRef.current?.contentDocument?.body.innerHTML);\n        \n\n        // 데이터 비우기\n        setBoardTitle({\n            title: '',\n            subTitle: ''\n        });\n        if(iframeRef.current && iframeRef.current.contentDocument){\n            iframeRef.current.contentDocument.body.innerHTML = \"\";\n        }\n\n\n        if(isUpdate){ // 수정일 경우\n            axios({\n                method: 'put',\n                url: '/api/board/list',\n                data: boardData\n            }).then((res) =>{\n                console.log('put_res', res.data[0]);\n                history.push('/board/view?_id=' + searchVal._id);\n            });\n            \n        }else{ // 신규일 경우\n            axios({\n                method: 'post',\n                url: '/api/board/list',\n                data: boardData\n            }).then((res) =>{\n                console.log('post_res', res.data[0]);\n                history.push('/board');\n            });\n            \n        }\n        \n    }\n\n    const onChangeTitle = (e: React.ChangeEvent<HTMLInputElement>) =>{\n        const {name, value} = e.target;\n        setBoardTitle({\n            ...boardTitle,\n            [name]: value\n        })\n    }\n\n    // 텍스트 에디터 만들기 시작\n    // 기능 : 볼드, 폰트사이즈 10~30, 이탤릭, 삭선, 밑줄, 번호, 점, 들여쓰기(2개), 링크, 이미지 삽입, 파일 첨부\n\n    return (\n        <main className=\"bb-board-write__main\">\n            <form className=\"bb-board-write__form\" onSubmit={onSubmit}>\n                <input className=\"bb-board-write__title\" placeholder=\"제목을 입력해주세요.\" type=\"text\" name=\"title\" value={boardTitle?.title} onChange={onChangeTitle}/>\n                <input className=\"bb-board-write__title--sub\" placeholder=\"소제목을 입력해주세요.\" type=\"text\" name=\"subTitle\" value={boardTitle?.subTitle} onChange={onChangeTitle}/>\n  \n\n                <div className=\"bb-board-write__editor-wrapper\">\n                    <ul className=\"bb-board-write__editor-options\" ref={optionsRef}>\n                        <li data-cmd=\"bold\" onClick={(e) => execCmd('bold', '', e)}><BsTypeBold /></li>\n                        <li data-cmd=\"italic\" onClick={(e) => execCmd('italic', '', e)}><BsTypeItalic /></li>\n                        <li data-cmd=\"underline\" onClick={(e) => execCmd('underline', '', e)}><BsTypeUnderline /></li>\n                        <li data-cmd=\"strikethrough\" onClick={(e) => execCmd('strikethrough', '', e)}><BsTypeStrikethrough /></li>\n                        <li data-cmd=\"justifycenter\" onClick={(e) => execCmd('justifycenter', '', e)}><BsTextCenter /></li>\n                        <li onClick={(e) => execCmd('insertunorderedlist', '')}><BsListUl /></li>\n                        <li onClick={(e) => execCmd('insertorderedlist', '')}><BsListOl /></li>\n                        <li onClick={(e) => execCmd('indent', '')}><BsTextIndentLeft /></li>\n                        <li onClick={(e) => execCmd('outdent', '')}><BsTextIndentRight /></li>\n                        <li onClick={fontSizeToggle}>\n                            <VscTextSize />\n                            <ul className=\"bb-board-write__editor-font-box\" ref={fontSizeRef}>\n                                <li onClick={(e) => execCmd('fontSize', '1')}>10px</li>\n                                <li onClick={(e) => execCmd('fontSize', '2')}>13px</li>\n                                <li onClick={(e) => execCmd('fontSize', '3')}>16px</li>\n                                <li onClick={(e) => execCmd('fontSize', '4')}>18px</li>\n                                <li onClick={(e) => execCmd('fontSize', '5')}>24px</li>\n                                <li onClick={(e) => execCmd('fontSize', '6')}>32px</li>\n                                <li onClick={(e) => execCmd('fontSize', '7')}>48px</li>\n                            </ul>\n                        </li>\n                    </ul>\n                    <iframe className=\"bb-board-wrtie__editor\" name=\"boadeditrot\" ref={iframeRef}></iframe>\n                </div>\n                \n\n\n\n                <div className=\"bb-board-write__buttons\">\n                    <button>취소</button>\n                    <button>완료</button>\n                </div>\n            </form>\n        </main>\n    )\n}\n\nexport default BoardWrite;"]},"metadata":{},"sourceType":"module"}